# kubernetes with Terraform

This project deploys a cluster of kubernetes with kubeadm and terradform.

It also installs ingress and two apps, one of them using Helm3.

Documentation is automatic generated by terraform-docs in markdown format.

## Requirements

1.- You have to create an AWS S3 bucket to enable remote state storage.
https://docs.aws.amazon.com/AmazonS3/latest/user-guide/create-bucket.html

2.- You have to create a AWS EC2 Key to prove your identity when connecting to an instance.

https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html#having-ec2-create-your-key-pair

## Usage

1.- Save the private key created in requirement 2 inside the keyPair folder. Must be called keyPair.pem

2.- Run this command:

docker build \
-t kubernetes-with-terraform \
--build-arg AWS_ACCESS_KEY_ID='<Your access key id>' \
--build-arg AWS_SECRET_ACCESS_KEY='<Your secret acces key>' \
--build-arg AWS_DEFAULT_REGION='us-east-1' \
--build-arg s3_bucket='<Your S3 Bucket (requirement 1)>' \
--build-arg key_pair='<Your Key Pair (requirement 2)>' \
 . && \
docker run -it --rm kubernetes-with-terraform

A docker container will be created and a bash shell is ready to go.

3.- Run this command:

./run.sh

When you log into an EC2 instances for the first time you have to add an SSH fingerprint to your known_hosts file. If you see some messages like this:

"The authenticity of host 'ec2-XX-XXX-XXX-XX.compute-1.amazonaws.com (XX.XXX.XXX.XX)' can't be established.
ECDSA key fingerprint is SHA256:XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX.
Are you sure you want to continue connecting (yes/no)"

Please answer yes.

4.- Enjoy!

5.- When you finish your reviews, run:

terraform destroy

to eliminate all created infraestructure in this demo.

6.- Run this command:

exit

to exit the docker container.
